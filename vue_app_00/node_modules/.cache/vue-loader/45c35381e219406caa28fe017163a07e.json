{"remainingRequest":"d:\\xampp\\htdocs\\tml1903\\online\\vue_app_00\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!d:\\xampp\\htdocs\\tml1903\\online\\vue_app_00\\src\\components\\booking\\common\\BookTics.vue?vue&type=style&index=0&id=deab0848&scoped=true&lang=css","dependencies":[{"path":"d:\\xampp\\htdocs\\tml1903\\online\\vue_app_00\\src\\components\\booking\\common\\BookTics.vue","mtime":1564110166307},{"path":"d:\\xampp\\htdocs\\tml1903\\online\\vue_app_00\\node_modules\\css-loader\\index.js","mtime":1562979687013},{"path":"d:\\xampp\\htdocs\\tml1903\\online\\vue_app_00\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1562979690388},{"path":"d:\\xampp\\htdocs\\tml1903\\online\\vue_app_00\\node_modules\\postcss-loader\\lib\\index.js","mtime":1562979689638},{"path":"d:\\xampp\\htdocs\\tml1903\\online\\vue_app_00\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1562979686325},{"path":"d:\\xampp\\htdocs\\tml1903\\online\\vue_app_00\\node_modules\\vue-loader\\lib\\index.js","mtime":1562979690388}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.container{\n  background-color:#f2f2f2;\n  color:#333;\n  font-size:12px;\n}\n.content{\n  padding:40px 0px;\n}\n.top{\n  height:40px;\n  text-align:center;\n  line-height:40px;\n  background-color:#26a2ff;\n  color:#fff;\n  font-size:14px;\n}\n/* 身份证错误信息提示框 */\n.cardMsg{\n  padding:10px;\n  text-align:center;\n  color:red;\n}\n/* 身份证错误标红 */\n.cardRed{\n  color:red;\n}\n/* 票种列表样式 */\n.tic{\n  padding:0px 20px;\n  padding-top:5px;\n  margin-bottom:5px;\n  color:#000;\n  font-size:16px;\n  background-color:#fff;\n}\n.tic1{\n  display:flex;\n  justify-content:space-between;\n}\n.tic1 span:last-child{\n  color:#e6a062;\n  padding-right:4px;\n}\n.tic2{\n  margin-top:10px;\n  padding-bottom:5px;\n  display:flex;\n  justify-content:space-between;\n  border-bottom:1px solid #f2f2f2;\n}\n.tic2 div:first-child{\n  font-size:13px;\n  color:#26a2ff;\n  border:1px solid #26a2ff;\n  width:60px;\n  height:20px;\n  text-align:center;\n  line-height:20px;\n  border-radius:3px;\n}\n.tic2 div.btns{\n  display:flex;\n}\n.tic2 div.btns span:nth-child(2){\n  display:inline-block;\n  width:30px;\n  color:#888;\n  text-align:center;\n  font-size:14px;\n}\n.tic2 div.btns span img{\n  width:20px;\n}\n.tic3{\n  padding:5px 0;\n  font-size:14px;\n  border-bottom:1px solid #f2f2f2;\n}\n.tic3 input{\n  border:none;\n  width:250px;\n  padding-left:5px;\n}\n/* 结算按钮和信息 */\n.cartBtm{\n  position:fixed;\n  bottom:37px;\n  width:100%;\n  display:flex;\n  text-align:center;\n}\n.cartBtm p{\n  height:50px;\n  line-height:50px;\n  font-size:20px;\n  margin:0;\n}\n.cartBtm p:first-child{\n  width:50%;\n  color:#e6a062;\n  background:#fff;\n}\n.cartBtm p+p{\n  background-color:#e6a062;\n  width:50%;\n  color:#fff;\n}\n",{"version":3,"sources":["BookTics.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6QA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"BookTics.vue","sourceRoot":"src\\components\\booking\\common","sourcesContent":["<template>\r\n  <div class=\"container\">\r\n    <!--顶部标题栏-->\r\n    <titlebar leftTitle=\"在线购票\"></titlebar>\r\n    <div class=\"content\">\r\n      <div class=\"top\">您正在选购<span>{{gdate}}</span>的票券</div>\r\n      <div v-show=\"cardMsg==1\" class=\"cardMsg\">请输入正确的身份证号</div>\r\n      <div id=\"cards\" class=\"tics\">\r\n        <!--循环票种列表-->\r\n        <div class=\"tic\" v-for=\"(elem,i) of ticList\" :key=\"i\">\r\n          <div class=\"tic1\">\r\n            <span v-text=\"elem.tname\"></span>\r\n            <span v-text=\"`¥${elem.tprice.toFixed(2)}`\"></span>\r\n          </div>\r\n          <div class=\"tic2\">\r\n            <div>网售票</div>\r\n            <div class=\"btns\">\r\n              <span @click=\"sub(i)\" v-show=\"tics[i].t>0\"><img src=\"../../../assets/sub.png\"></span>\r\n              <span v-text=\"tics[i].t\"></span>\r\n              <span @click=\"add(i)\" :data-idx=\"i\"><img src=\"../../../assets/add.png\"></span>\r\n            </div>\r\n          </div>\r\n          <div class=\"tic3\" v-for=\"(elem,i) of cards[i].c\">\r\n            身份证：<input @blur=\"cardOK\" placeholder=\"请输入身份证号码\" v-model=\"elem.num\"></input>\r\n          </div>\r\n        </div>\r\n\r\n      </div>\r\n    </div>\r\n\r\n    <!--结算按钮和信息-->\r\n    <div class=\"cartBtm\">\r\n      <p>合计：<span>{{ticCount}}</span>张</p>\r\n      <p><span @click=\"next\">提交订单</span></p>\r\n    </div>\r\n\r\n    <!--底部箭头栏-->\r\n    <bottombar left=\"/Booking\" :right=\"jumpRight\"></bottombar>\r\n    \r\n    \r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  // 引入相关子组件\r\n  import TitleBar from \"./TitleBar.vue\";\r\n  import Bottom from \"./Bottom.vue\";\r\n\r\n  export default {\r\n    data(){\r\n      return {\r\n        gdate:\"\",\r\n        // 从数据库调出的票种信息\r\n        ticList:[],\r\n        // 每种票的购票小计\r\n        prices:[\r\n          {p:0},\r\n          {p:0},\r\n          {p:0},\r\n          {p:0}\r\n        ],\r\n        // 购票数\r\n        tics:[\r\n          {t:0},\r\n          {t:0},\r\n          {t:0},\r\n          {t:0}\r\n        ],\r\n        // 购票身份证数量\r\n        cardNo:[0,0,0,0],\r\n        // 购票身份证\r\n        cards:[\r\n          {c:[]},\r\n          {c:[]},\r\n          {c:[]},\r\n          {c:[]},\r\n        ],\r\n        // 控制身份证错误提示信息显示\r\n        cardMsg:0,\r\n        // 判断向右跳转路径地址\r\n        jumpRight:\"\"\r\n      }//return结束\r\n    },//data结束\r\n    // 计算属性\r\n    computed: {\r\n      // 总购票数\r\n      ticCount(){\r\n        var sum=0;\r\n        for(var i=0; i<this.tics.length; i++){\r\n          sum+=this.tics[i].t;\r\n        }\r\n        return sum;\r\n      },\r\n      // 总购票价格\r\n      priceCount(){\r\n        var sum=0;\r\n        for(var i=0; i<this.prices.length; i++){\r\n          sum+=this.prices[i].p;\r\n        }\r\n        return sum;\r\n      }\r\n    },\r\n    components:{\r\n      \"titlebar\":TitleBar,\r\n      \"bottombar\":Bottom,\r\n    },\r\n    methods:{\r\n      // 增加按钮单击事件\r\n      add(i){\r\n        // 票数增加\r\n        this.tics[i].t++;\r\n        // 身份证输入框增加\r\n        this.cards[i].c[this.cardNo[i]]={id:0,num:\"\"}\r\n        // 身份证数量增加\r\n        this.cardNo[i]++;\r\n        // 计算每种票的价格小计\r\n        this.prices[i].p=this.ticList[i].tprice*this.tics[i].t;\r\n        console.log(this.priceCount);\r\n      },\r\n      sub(i){\r\n        if(this.tics[i].t>0){\r\n        // 票数减少\r\n        this.tics[i].t--;\r\n        // 身份证输入框减少 删除栈顶元素\r\n        this.cards[i].c.pop();\r\n        // 身份证数量减少\r\n        this.cardNo[i]--;\r\n        }\r\n        \r\n      },\r\n      // 提交订单按钮\r\n      next(){\r\n        var cardDiv=document.getElementById(\"cards\");\r\n        var elems=cardDiv.getElementsByClassName(\"cardRed\");\r\n        console.log(elems);\r\n        // 判断有无空身份证号 设置变量num接收有几个空的身份证\r\n        var num=0;\r\n        for(var i=0; i<this.cards.length; i++){\r\n          // console.log(this.cards.length);\r\n          for(var j=0; j<this.cards[i].c.length; j++){\r\n            // console.log(this.cards[i].c.length);\r\n            // console.log(this.cards[i].c[j].num);\r\n            if(this.cards[i].c[j].num==\"\"){\r\n              num++;\r\n            }\r\n          }\r\n        }\r\n        // console.log(num);\r\n        // 如果没有身份证框有cardRed样式，并且num=0,则执行提交订单操作\r\n        if(elems.length==0&&num==0){\r\n          // 将购物车信息保存在sessionStorage中\r\n        var cart=[];\r\n        for(var i=0; i<this.ticList.length; i++){\r\n          var info=[];\r\n          // console.log(info);\r\n          if(this.tics[i].t>0){\r\n            for(var j=0; j<this.tics[i].t; j++){\r\n              // 获得每个票种的单张票信息\r\n              var info1={};\r\n              // 票种\r\n              info1.book=this.ticList[i].tname;\r\n              // 身份证号\r\n              info1.bcard=this.cards[i].c[j].num;\r\n              // 价格\r\n              info1.bprice=this.ticList[i].tprice;\r\n              // 单张票的订单状态    0：未付款   1：已付款\r\n              info1.bstatus=0;\r\n              // 日期\r\n              info1.bdate=this.gdate;\r\n              // 当前登录的用户编号uid\r\n              info1.b_id=sessionStorage.getItem(\"uid\")\r\n              // console.log(info);\r\n              // 获得每个票种的所有票信息\r\n              info.push(info1);\r\n            }\r\n            // 放入购物车数组\r\n            cart.push(info);\r\n          }\r\n        }\r\n        console.log(cart);\r\n        // 将购物车数组转为JSON字符串str\r\n        var str=JSON.stringify(cart);\r\n        // 验证购物车是否为空\r\n        if(str==\"[]\"){\r\n          this.$toast(\"请选择门票\");\r\n        }else{\r\n          // 将str放入sessionStorage中\r\n          sessionStorage.setItem(\"cart\",str);\r\n          // console.log(sessionStorage.cart);\r\n          // 跳转到结算界面\r\n          this.$router.push(\"/BookCart\");\r\n        }\r\n        }\r\n        \r\n      },\r\n      // 输入框失去焦点事件\r\n      // 验证输入的身份证是否正确\r\n      cardOK(e){\r\n        // 获得当前输入框的值\r\n        var str=e.target.value;\r\n        // 正则表达式\r\n        var reg=/^\\d{15}(\\d\\d[0-9Xx])?$/;\r\n        if(!reg.exec(str)){\r\n          // 不符合，则更改cardMsg值，控制提示信息框的显示\r\n          // this.cardMsg=1;\r\n          e.target.className=\"cardRed\";\r\n        }else{\r\n          // 身份证改对后，把cardMsg值改回来\r\n          // this.cardMsg=0;\r\n          e.target.className=\"\";\r\n        }\r\n        // 如果身份证框有样式cardRed，则cardMsg为1，否则为0\r\n        // 保证只要有身份证不对，提示框显示\r\n        var cardDiv=document.getElementById(\"cards\");\r\n        var elems=cardDiv.getElementsByClassName(\"cardRed\");\r\n        console.log(elems);\r\n        if(elems.length>0){\r\n          this.cardMsg=1\r\n        }else{\r\n          this.cardMsg=0;\r\n        }\r\n\r\n      }\r\n      \r\n    },\r\n    created(){\r\n      // 功能1：页面运行到订单第二个页面\r\n      sessionStorage.setItem(\"pageNo2\",2);\r\n      // 功能2：判定用户是否已登录，如果没有，跳转到登录页面\r\n      if(!sessionStorage.getItem(\"uname\")){\r\n        // 将当前的路由地址保存在sessionStorage中，登录后可跳回此页面\r\n        sessionStorage.setItem(\"jumpRouter\",\"/BookTics\");\r\n        this.$messagebox(\"请先登录\")\r\n          .then(action=>{\r\n            this.$router.push(\"/Login\");\r\n          })\r\n          .catch(err=>{console.log(err)}\r\n        );\r\n      }\r\n      // 功能3：获得购票日期\r\n      this.gdate=sessionStorage.getItem(\"gdate\");\r\n      // 功能4：发送请求，获得票种列表\r\n      this.axios.get(\"tics\",{params:{}})\r\n      .then(res=>{\r\n        this.ticList=res.data;\r\n        // console.log(this.ticList);\r\n      });\r\n      // 功能5：判断程序是否运行过第三个订单页面，是，则向右箭头加路径\r\n      var num=sessionStorage.getItem(\"pageNo3\");\r\n      if(num==3){\r\n        this.jumpRight=\"/BookCart\";\r\n      };\r\n      /*\r\n      // 功能6：页面跳转回此页面后恢复选择后的信息\r\n      var obj=JSON.parse(sessionStorage.cart);\r\n      for(var i=0;i<obj.length; i++){\r\n        console.log(obj[i][0]);\r\n        this.tics[i].t=obj[i].length;\r\n        // 获取购票数\r\n        console.log(this.tics[i].t,typeof(this.tics[i].t));\r\n        // 获取身份证号\r\n      }\r\n      */\r\n      \r\n    }\r\n  }\r\n</script>\r\n\r\n<style scoped>\r\n  .container{\r\n    background-color:#f2f2f2;\r\n    color:#333;\r\n    font-size:12px;\r\n  }\r\n  .content{\r\n    padding:40px 0px;\r\n  }\r\n  .top{\r\n    height:40px;\r\n    text-align:center;\r\n    line-height:40px;\r\n    background-color:#26a2ff;\r\n    color:#fff;\r\n    font-size:14px;\r\n  }\r\n  /* 身份证错误信息提示框 */\r\n  .cardMsg{\r\n    padding:10px;\r\n    text-align:center;\r\n    color:red;\r\n  }\r\n  /* 身份证错误标红 */\r\n  .cardRed{\r\n    color:red;\r\n  }\r\n  /* 票种列表样式 */\r\n  .tic{\r\n    padding:0px 20px;\r\n    padding-top:5px;\r\n    margin-bottom:5px;\r\n    color:#000;\r\n    font-size:16px;\r\n    background-color:#fff;\r\n  }\r\n  .tic1{\r\n    display:flex;\r\n    justify-content:space-between;\r\n  }\r\n  .tic1 span:last-child{\r\n    color:#e6a062;\r\n    padding-right:4px;\r\n  }\r\n  .tic2{\r\n    margin-top:10px;\r\n    padding-bottom:5px;\r\n    display:flex;\r\n    justify-content:space-between;\r\n    border-bottom:1px solid #f2f2f2;\r\n  }\r\n  .tic2 div:first-child{\r\n    font-size:13px;\r\n    color:#26a2ff;\r\n    border:1px solid #26a2ff;\r\n    width:60px;\r\n    height:20px;\r\n    text-align:center;\r\n    line-height:20px;\r\n    border-radius:3px;\r\n  }\r\n  .tic2 div.btns{\r\n    display:flex;\r\n  }\r\n  .tic2 div.btns span:nth-child(2){\r\n    display:inline-block;\r\n    width:30px;\r\n    color:#888;\r\n    text-align:center;\r\n    font-size:14px;\r\n  }\r\n  .tic2 div.btns span img{\r\n    width:20px;\r\n  }\r\n  .tic3{\r\n    padding:5px 0;\r\n    font-size:14px;\r\n    border-bottom:1px solid #f2f2f2;\r\n  }\r\n  .tic3 input{\r\n    border:none;\r\n    width:250px;\r\n    padding-left:5px;\r\n  }\r\n  /* 结算按钮和信息 */\r\n  .cartBtm{\r\n    position:fixed;\r\n    bottom:37px;\r\n    width:100%;\r\n    display:flex;\r\n    text-align:center;\r\n  }\r\n  .cartBtm p{\r\n    height:50px;\r\n    line-height:50px;\r\n    font-size:20px;\r\n    margin:0;\r\n  }\r\n  .cartBtm p:first-child{\r\n    width:50%;\r\n    color:#e6a062;\r\n    background:#fff;\r\n  }\r\n  .cartBtm p+p{\r\n    background-color:#e6a062;\r\n    width:50%;\r\n    color:#fff;\r\n  }\r\n</style>"]}]}