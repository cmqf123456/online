{"remainingRequest":"d:\\xampp\\htdocs\\tml1903\\online\\vue_app_00\\node_modules\\babel-loader\\lib\\index.js!d:\\xampp\\htdocs\\tml1903\\online\\vue_app_00\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!d:\\xampp\\htdocs\\tml1903\\online\\vue_app_00\\src\\components\\booking\\common\\BookTics.vue?vue&type=script&lang=js","dependencies":[{"path":"d:\\xampp\\htdocs\\tml1903\\online\\vue_app_00\\src\\components\\booking\\common\\BookTics.vue","mtime":1564060314973},{"path":"d:\\xampp\\htdocs\\tml1903\\online\\vue_app_00\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1562979686325},{"path":"d:\\xampp\\htdocs\\tml1903\\online\\vue_app_00\\node_modules\\babel-loader\\lib\\index.js","mtime":1562979686216},{"path":"d:\\xampp\\htdocs\\tml1903\\online\\vue_app_00\\node_modules\\vue-loader\\lib\\index.js","mtime":1562979690388}],"contextDependencies":[],"result":["import _typeof from \"d:\\\\xampp\\\\htdocs\\\\tml1903\\\\online\\\\vue_app_00\\\\node_modules\\\\@babel\\\\runtime/helpers/builtin/es6/typeof\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n// 引入相关子组件\nimport TitleBar from \"./TitleBar.vue\";\nimport Bottom from \"./Bottom.vue\";\nexport default {\n  data: function data() {\n    return {\n      gdate: \"\",\n      // 从数据库调出的票种信息\n      ticList: [],\n      // 每种票的购票小计\n      prices: [{\n        p: 0\n      }, {\n        p: 0\n      }, {\n        p: 0\n      }, {\n        p: 0\n      }],\n      // 购票数\n      tics: [{\n        t: 0\n      }, {\n        t: 0\n      }, {\n        t: 0\n      }, {\n        t: 0\n      }],\n      // 购票身份证数量\n      cardNo: [0, 0, 0, 0],\n      // 购票身份证\n      cards: [{\n        c: []\n      }, {\n        c: []\n      }, {\n        c: []\n      }, {\n        c: []\n      }],\n      // 控制身份证错误提示信息显示\n      cardMsg: 0,\n      // 判断向右跳转路径地址\n      jumpRight: \"\" //return结束\n\n    };\n  },\n  //data结束\n  // 计算属性\n  computed: {\n    // 总购票数\n    ticCount: function ticCount() {\n      var sum = 0;\n\n      for (var i = 0; i < this.tics.length; i++) {\n        sum += this.tics[i].t;\n      }\n\n      return sum;\n    },\n    // 总购票价格\n    priceCount: function priceCount() {\n      var sum = 0;\n\n      for (var i = 0; i < this.prices.length; i++) {\n        sum += this.prices[i].p;\n      }\n\n      return sum;\n    }\n  },\n  components: {\n    \"titlebar\": TitleBar,\n    \"bottombar\": Bottom\n  },\n  methods: {\n    // 增加按钮单击事件\n    add: function add(i) {\n      // 票数增加\n      this.tics[i].t++; // 身份证输入框增加\n\n      this.cards[i].c[this.cardNo[i]] = {\n        id: 0,\n        num: \"\" // 身份证数量增加\n\n      };\n      this.cardNo[i]++; // 计算每种票的价格小计\n\n      this.prices[i].p = this.ticList[i].tprice * this.tics[i].t;\n      console.log(this.priceCount);\n    },\n    sub: function sub(i) {\n      if (this.tics[i].t > 0) {\n        // 票数减少\n        this.tics[i].t--; // 身份证输入框减少 删除栈顶元素\n\n        this.cards[i].c.pop(); // 身份证数量减少\n\n        this.cardNo[i]--;\n      }\n    },\n    // 提交订单按钮\n    next: function next() {\n      var cardDiv = document.getElementById(\"cards\");\n      var elems = cardDiv.getElementsByClassName(\"cardRed\");\n      console.log(elems); // 判断有无空身份证号 设置变量num接收有几个空的身份证\n\n      var num = 0;\n\n      for (var i = 0; i < this.cards.length; i++) {\n        // console.log(this.cards.length);\n        for (var j = 0; j < this.cards[i].c.length; j++) {\n          // console.log(this.cards[i].c.length);\n          // console.log(this.cards[i].c[j].num);\n          if (this.cards[i].c[j].num == \"\") {\n            num++;\n          }\n        }\n      } // console.log(num);\n      // 如果没有身份证框有cardRed样式，并且num=0,则执行提交订单操作\n\n\n      if (elems.length == 0 && num == 0) {\n        // 将购物车信息保存在sessionStorage中\n        var cart = [];\n\n        for (var i = 0; i < this.ticList.length; i++) {\n          var info = []; // console.log(info);\n\n          if (this.tics[i].t > 0) {\n            for (var j = 0; j < this.tics[i].t; j++) {\n              // 获得每个票种的单张票信息\n              var info1 = {}; // 票种\n\n              info1.book = this.ticList[i].tname; // 身份证号\n\n              info1.bcard = this.cards[i].c[j].num; // 价格\n\n              info1.bprice = this.ticList[i].tprice; // 单张票的订单状态    0：未付款   1：已付款\n\n              info1.bstatus = 0; // 日期\n\n              info1.bdate = this.gdate; // 当前登录的用户编号uid\n\n              info1.b_id = sessionStorage.getItem(\"uid\"); // console.log(info);\n              // 获得每个票种的所有票信息\n\n              info.push(info1);\n            } // 放入购物车数组\n\n\n            cart.push(info);\n          }\n        }\n\n        console.log(cart); // 将购物车数组转为JSON字符串str\n\n        var str = JSON.stringify(cart); // 验证购物车是否为空\n\n        if (str == \"[]\") {\n          this.$toast(\"请选择门票\");\n        } else {\n          // 将str放入sessionStorage中\n          sessionStorage.setItem(\"cart\", str); // console.log(sessionStorage.cart);\n          // 跳转到结算界面\n\n          this.$router.push(\"/BookCart\");\n        }\n      }\n    },\n    // 输入框失去焦点事件\n    // 验证输入的身份证是否正确\n    cardOK: function cardOK(e) {\n      // 获得当前输入框的值\n      var str = e.target.value; // 正则表达式\n\n      var reg = /^\\d{15}(\\d\\d[0-9Xx])?$/;\n\n      if (!reg.exec(str)) {\n        // 不符合，则更改cardMsg值，控制提示信息框的显示\n        // this.cardMsg=1;\n        e.target.className = \"cardRed\";\n      } else {\n        // 身份证改对后，把cardMsg值改回来\n        // this.cardMsg=0;\n        e.target.className = \"\";\n      } // 如果身份证框有样式cardRed，则cardMsg为1，否则为0\n      // 保证只要有身份证不对，提示框显示\n\n\n      var cardDiv = document.getElementById(\"cards\");\n      var elems = cardDiv.getElementsByClassName(\"cardRed\");\n      console.log(elems);\n\n      if (elems.length > 0) {\n        this.cardMsg = 1;\n      } else {\n        this.cardMsg = 0;\n      }\n    }\n  },\n  created: function created() {\n    var _this = this;\n\n    // 功能1：页面运行到订单第二个页面\n    sessionStorage.setItem(\"pageNo2\", 2); // 功能2：判定用户是否已登录，如果没有，跳转到登录页面\n\n    if (!sessionStorage.getItem(\"uname\")) {\n      // 将当前的路由地址保存在sessionStorage中，登录后可跳回此页面\n      sessionStorage.setItem(\"jumpRouter\", \"/BookTics\");\n      this.$messagebox(\"请先登录\").then(function (action) {\n        _this.$router.push(\"/Login\");\n      }).catch(function (err) {\n        console.log(err);\n      });\n    } // 功能3：获得购票日期\n\n\n    this.gdate = sessionStorage.getItem(\"gdate\"); // 功能4：发送请求，获得票种列表\n\n    this.axios.get(\"tics\", {\n      params: {}\n    }).then(function (res) {\n      _this.ticList = res.data; // console.log(this.ticList);\n    }); // 功能5：判断程序是否运行过第三个订单页面，是，则向右箭头加路径\n\n    var num = sessionStorage.getItem(\"pageNo3\");\n\n    if (num == 3) {\n      this.jumpRight = \"/BookCart\";\n    }\n\n    ; // 功能6：页面跳转回此页面后恢复选择后的信息\n\n    var obj = JSON.parse(sessionStorage.cart);\n\n    for (var i = 0; i < obj.length; i++) {\n      console.log(obj[i][0]);\n      this.tics[i].t = obj[i].length; // 获取购票数\n\n      console.log(this.tics[i].t, _typeof(this.tics[i].t)); // 获取身份证号\n    }\n  }\n};",{"version":3,"sources":["BookTics.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4CA;AACA,OAAA,QAAA,MAAA,gBAAA;AACA,OAAA,MAAA,MAAA,cAAA;AAEA,eAAA;AACA,MADA,kBACA;AACA,WAAA;AACA,aAAA,EADA;AAEA;AACA,eAAA,EAHA;AAIA;AACA,cAAA,CACA;AAAA,WAAA;AAAA,OADA,EAEA;AAAA,WAAA;AAAA,OAFA,EAGA;AAAA,WAAA;AAAA,OAHA,EAIA;AAAA,WAAA;AAAA,OAJA,CALA;AAWA;AACA,YAAA,CACA;AAAA,WAAA;AAAA,OADA,EAEA;AAAA,WAAA;AAAA,OAFA,EAGA;AAAA,WAAA;AAAA,OAHA,EAIA;AAAA,WAAA;AAAA,OAJA,CAZA;AAkBA;AACA,cAAA,CAAA,CAAA,EAAA,CAAA,EAAA,CAAA,EAAA,CAAA,CAnBA;AAoBA;AACA,aAAA,CACA;AAAA,WAAA;AAAA,OADA,EAEA;AAAA,WAAA;AAAA,OAFA,EAGA;AAAA,WAAA;AAAA,OAHA,EAIA;AAAA,WAAA;AAAA,OAJA,CArBA;AA2BA;AACA,eAAA,CA5BA;AA6BA;AACA,iBAAA,EA9BA,CA+BA;;AA/BA,KAAA;AAgCA,GAlCA;AAkCA;AACA;AACA,YAAA;AACA;AACA,YAFA,sBAEA;AACA,UAAA,MAAA,CAAA;;AACA,WAAA,IAAA,IAAA,CAAA,EAAA,IAAA,KAAA,IAAA,CAAA,MAAA,EAAA,GAAA,EAAA;AACA,eAAA,KAAA,IAAA,CAAA,CAAA,EAAA,CAAA;AACA;;AACA,aAAA,GAAA;AACA,KARA;AASA;AACA,cAVA,wBAUA;AACA,UAAA,MAAA,CAAA;;AACA,WAAA,IAAA,IAAA,CAAA,EAAA,IAAA,KAAA,MAAA,CAAA,MAAA,EAAA,GAAA,EAAA;AACA,eAAA,KAAA,MAAA,CAAA,CAAA,EAAA,CAAA;AACA;;AACA,aAAA,GAAA;AACA;AAhBA,GApCA;AAsDA,cAAA;AACA,gBAAA,QADA;AAEA,iBAAA;AAFA,GAtDA;AA0DA,WAAA;AACA;AACA,OAFA,eAEA,CAFA,EAEA;AACA;AACA,WAAA,IAAA,CAAA,CAAA,EAAA,CAAA,GAFA,CAGA;;AACA,WAAA,KAAA,CAAA,CAAA,EAAA,CAAA,CAAA,KAAA,MAAA,CAAA,CAAA,CAAA,IAAA;AAAA,YAAA,CAAA;AAAA,aAAA,EAAA,CACA;;AADA,OAAA;AAEA,WAAA,MAAA,CAAA,CAAA,IANA,CAOA;;AACA,WAAA,MAAA,CAAA,CAAA,EAAA,CAAA,GAAA,KAAA,OAAA,CAAA,CAAA,EAAA,MAAA,GAAA,KAAA,IAAA,CAAA,CAAA,EAAA,CAAA;AACA,cAAA,GAAA,CAAA,KAAA,UAAA;AACA,KAZA;AAaA,OAbA,eAaA,CAbA,EAaA;AACA,UAAA,KAAA,IAAA,CAAA,CAAA,EAAA,CAAA,GAAA,CAAA,EAAA;AACA;AACA,aAAA,IAAA,CAAA,CAAA,EAAA,CAAA,GAFA,CAGA;;AACA,aAAA,KAAA,CAAA,CAAA,EAAA,CAAA,CAAA,GAAA,GAJA,CAKA;;AACA,aAAA,MAAA,CAAA,CAAA;AACA;AAEA,KAvBA;AAwBA;AACA,QAzBA,kBAyBA;AACA,UAAA,UAAA,SAAA,cAAA,CAAA,OAAA,CAAA;AACA,UAAA,QAAA,QAAA,sBAAA,CAAA,SAAA,CAAA;AACA,cAAA,GAAA,CAAA,KAAA,EAHA,CAIA;;AACA,UAAA,MAAA,CAAA;;AACA,WAAA,IAAA,IAAA,CAAA,EAAA,IAAA,KAAA,KAAA,CAAA,MAAA,EAAA,GAAA,EAAA;AACA;AACA,aAAA,IAAA,IAAA,CAAA,EAAA,IAAA,KAAA,KAAA,CAAA,CAAA,EAAA,CAAA,CAAA,MAAA,EAAA,GAAA,EAAA;AACA;AACA;AACA,cAAA,KAAA,KAAA,CAAA,CAAA,EAAA,CAAA,CAAA,CAAA,EAAA,GAAA,IAAA,EAAA,EAAA;AACA;AACA;AACA;AACA,OAfA,CAgBA;AACA;;;AACA,UAAA,MAAA,MAAA,IAAA,CAAA,IAAA,OAAA,CAAA,EAAA;AACA;AACA,YAAA,OAAA,EAAA;;AACA,aAAA,IAAA,IAAA,CAAA,EAAA,IAAA,KAAA,OAAA,CAAA,MAAA,EAAA,GAAA,EAAA;AACA,cAAA,OAAA,EAAA,CADA,CAEA;;AACA,cAAA,KAAA,IAAA,CAAA,CAAA,EAAA,CAAA,GAAA,CAAA,EAAA;AACA,iBAAA,IAAA,IAAA,CAAA,EAAA,IAAA,KAAA,IAAA,CAAA,CAAA,EAAA,CAAA,EAAA,GAAA,EAAA;AACA;AACA,kBAAA,QAAA,EAAA,CAFA,CAGA;;AACA,oBAAA,IAAA,GAAA,KAAA,OAAA,CAAA,CAAA,EAAA,KAAA,CAJA,CAKA;;AACA,oBAAA,KAAA,GAAA,KAAA,KAAA,CAAA,CAAA,EAAA,CAAA,CAAA,CAAA,EAAA,GAAA,CANA,CAOA;;AACA,oBAAA,MAAA,GAAA,KAAA,OAAA,CAAA,CAAA,EAAA,MAAA,CARA,CASA;;AACA,oBAAA,OAAA,GAAA,CAAA,CAVA,CAWA;;AACA,oBAAA,KAAA,GAAA,KAAA,KAAA,CAZA,CAaA;;AACA,oBAAA,IAAA,GAAA,eAAA,OAAA,CAAA,KAAA,CAAA,CAdA,CAeA;AACA;;AACA,mBAAA,IAAA,CAAA,KAAA;AACA,aAnBA,CAoBA;;;AACA,iBAAA,IAAA,CAAA,IAAA;AACA;AACA;;AACA,gBAAA,GAAA,CAAA,IAAA,EA9BA,CA+BA;;AACA,YAAA,MAAA,KAAA,SAAA,CAAA,IAAA,CAAA,CAhCA,CAiCA;;AACA,YAAA,OAAA,IAAA,EAAA;AACA,eAAA,MAAA,CAAA,OAAA;AACA,SAFA,MAEA;AACA;AACA,yBAAA,OAAA,CAAA,MAAA,EAAA,GAAA,EAFA,CAGA;AACA;;AACA,eAAA,OAAA,CAAA,IAAA,CAAA,WAAA;AACA;AACA;AAEA,KAxFA;AAyFA;AACA;AACA,UA3FA,kBA2FA,CA3FA,EA2FA;AACA;AACA,UAAA,MAAA,EAAA,MAAA,CAAA,KAAA,CAFA,CAGA;;AACA,UAAA,MAAA,wBAAA;;AACA,UAAA,CAAA,IAAA,IAAA,CAAA,GAAA,CAAA,EAAA;AACA;AACA;AACA,UAAA,MAAA,CAAA,SAAA,GAAA,SAAA;AACA,OAJA,MAIA;AACA;AACA;AACA,UAAA,MAAA,CAAA,SAAA,GAAA,EAAA;AACA,OAbA,CAcA;AACA;;;AACA,UAAA,UAAA,SAAA,cAAA,CAAA,OAAA,CAAA;AACA,UAAA,QAAA,QAAA,sBAAA,CAAA,SAAA,CAAA;AACA,cAAA,GAAA,CAAA,KAAA;;AACA,UAAA,MAAA,MAAA,GAAA,CAAA,EAAA;AACA,aAAA,OAAA,GAAA,CAAA;AACA,OAFA,MAEA;AACA,aAAA,OAAA,GAAA,CAAA;AACA;AAEA;AApHA,GA1DA;AAiLA,SAjLA,qBAiLA;AAAA;;AACA;AACA,mBAAA,OAAA,CAAA,SAAA,EAAA,CAAA,EAFA,CAGA;;AACA,QAAA,CAAA,eAAA,OAAA,CAAA,OAAA,CAAA,EAAA;AACA;AACA,qBAAA,OAAA,CAAA,YAAA,EAAA,WAAA;AACA,WAAA,WAAA,CAAA,MAAA,EACA,IADA,CACA,kBAAA;AACA,cAAA,OAAA,CAAA,IAAA,CAAA,QAAA;AACA,OAHA,EAIA,KAJA,CAIA,eAAA;AAAA,gBAAA,GAAA,CAAA,GAAA;AAAA,OAJA;AAMA,KAbA,CAcA;;;AACA,SAAA,KAAA,GAAA,eAAA,OAAA,CAAA,OAAA,CAAA,CAfA,CAgBA;;AACA,SAAA,KAAA,CAAA,GAAA,CAAA,MAAA,EAAA;AAAA,cAAA;AAAA,KAAA,EACA,IADA,CACA,eAAA;AACA,YAAA,OAAA,GAAA,IAAA,IAAA,CADA,CAEA;AACA,KAJA,EAjBA,CAsBA;;AACA,QAAA,MAAA,eAAA,OAAA,CAAA,SAAA,CAAA;;AACA,QAAA,OAAA,CAAA,EAAA;AACA,WAAA,SAAA,GAAA,WAAA;AACA;;AAAA,KA1BA,CA2BA;;AACA,QAAA,MAAA,KAAA,KAAA,CAAA,eAAA,IAAA,CAAA;;AACA,SAAA,IAAA,IAAA,CAAA,EAAA,IAAA,IAAA,MAAA,EAAA,GAAA,EAAA;AACA,cAAA,GAAA,CAAA,IAAA,CAAA,EAAA,CAAA,CAAA;AACA,WAAA,IAAA,CAAA,CAAA,EAAA,CAAA,GAAA,IAAA,CAAA,EAAA,MAAA,CAFA,CAGA;;AACA,cAAA,GAAA,CAAA,KAAA,IAAA,CAAA,CAAA,EAAA,CAAA,UAAA,KAAA,IAAA,CAAA,CAAA,EAAA,CAAA,GAJA,CAKA;AACA;AAEA;AAtNA,CAAA","sourcesContent":["<template>\r\n  <div class=\"container\">\r\n    <!--顶部标题栏-->\r\n    <titlebar leftTitle=\"在线购票\"></titlebar>\r\n    <div class=\"content\">\r\n      <div class=\"top\">您正在选购<span>{{gdate}}</span>的票券</div>\r\n      <div v-show=\"cardMsg==1\" class=\"cardMsg\">请输入正确的身份证号</div>\r\n      <div id=\"cards\" class=\"tics\">\r\n        <!--循环票种列表-->\r\n        <div class=\"tic\" v-for=\"(elem,i) of ticList\" :key=\"i\">\r\n          <div class=\"tic1\">\r\n            <span v-text=\"elem.tname\"></span>\r\n            <span v-text=\"`¥${elem.tprice.toFixed(2)}`\"></span>\r\n          </div>\r\n          <div class=\"tic2\">\r\n            <div>网售票</div>\r\n            <div class=\"btns\">\r\n              <span @click=\"sub(i)\" v-show=\"tics[i].t>0\"><img src=\"../../../assets/sub.png\"></span>\r\n              <span v-text=\"tics[i].t\"></span>\r\n              <span @click=\"add(i)\" :data-idx=\"i\"><img src=\"../../../assets/add.png\"></span>\r\n            </div>\r\n          </div>\r\n          <div class=\"tic3\" v-for=\"(elem,i) of cards[i].c\">\r\n            身份证：<input @blur=\"cardOK\" placeholder=\"请输入身份证号码\" v-model=\"elem.num\"></input>\r\n          </div>\r\n        </div>\r\n\r\n      </div>\r\n    </div>\r\n\r\n    <!--结算按钮和信息-->\r\n    <div class=\"cartBtm\">\r\n      <p>合计：<span>{{ticCount}}</span>张</p>\r\n      <p><span @click=\"next\">提交订单</span></p>\r\n    </div>\r\n\r\n    <!--底部箭头栏-->\r\n    <bottombar left=\"/Booking\" :right=\"jumpRight\"></bottombar>\r\n    \r\n    \r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  // 引入相关子组件\r\n  import TitleBar from \"./TitleBar.vue\";\r\n  import Bottom from \"./Bottom.vue\";\r\n\r\n  export default {\r\n    data(){\r\n      return {\r\n        gdate:\"\",\r\n        // 从数据库调出的票种信息\r\n        ticList:[],\r\n        // 每种票的购票小计\r\n        prices:[\r\n          {p:0},\r\n          {p:0},\r\n          {p:0},\r\n          {p:0}\r\n        ],\r\n        // 购票数\r\n        tics:[\r\n          {t:0},\r\n          {t:0},\r\n          {t:0},\r\n          {t:0}\r\n        ],\r\n        // 购票身份证数量\r\n        cardNo:[0,0,0,0],\r\n        // 购票身份证\r\n        cards:[\r\n          {c:[]},\r\n          {c:[]},\r\n          {c:[]},\r\n          {c:[]},\r\n        ],\r\n        // 控制身份证错误提示信息显示\r\n        cardMsg:0,\r\n        // 判断向右跳转路径地址\r\n        jumpRight:\"\"\r\n      }//return结束\r\n    },//data结束\r\n    // 计算属性\r\n    computed: {\r\n      // 总购票数\r\n      ticCount(){\r\n        var sum=0;\r\n        for(var i=0; i<this.tics.length; i++){\r\n          sum+=this.tics[i].t;\r\n        }\r\n        return sum;\r\n      },\r\n      // 总购票价格\r\n      priceCount(){\r\n        var sum=0;\r\n        for(var i=0; i<this.prices.length; i++){\r\n          sum+=this.prices[i].p;\r\n        }\r\n        return sum;\r\n      }\r\n    },\r\n    components:{\r\n      \"titlebar\":TitleBar,\r\n      \"bottombar\":Bottom,\r\n    },\r\n    methods:{\r\n      // 增加按钮单击事件\r\n      add(i){\r\n        // 票数增加\r\n        this.tics[i].t++;\r\n        // 身份证输入框增加\r\n        this.cards[i].c[this.cardNo[i]]={id:0,num:\"\"}\r\n        // 身份证数量增加\r\n        this.cardNo[i]++;\r\n        // 计算每种票的价格小计\r\n        this.prices[i].p=this.ticList[i].tprice*this.tics[i].t;\r\n        console.log(this.priceCount);\r\n      },\r\n      sub(i){\r\n        if(this.tics[i].t>0){\r\n        // 票数减少\r\n        this.tics[i].t--;\r\n        // 身份证输入框减少 删除栈顶元素\r\n        this.cards[i].c.pop();\r\n        // 身份证数量减少\r\n        this.cardNo[i]--;\r\n        }\r\n        \r\n      },\r\n      // 提交订单按钮\r\n      next(){\r\n        var cardDiv=document.getElementById(\"cards\");\r\n        var elems=cardDiv.getElementsByClassName(\"cardRed\");\r\n        console.log(elems);\r\n        // 判断有无空身份证号 设置变量num接收有几个空的身份证\r\n        var num=0;\r\n        for(var i=0; i<this.cards.length; i++){\r\n          // console.log(this.cards.length);\r\n          for(var j=0; j<this.cards[i].c.length; j++){\r\n            // console.log(this.cards[i].c.length);\r\n            // console.log(this.cards[i].c[j].num);\r\n            if(this.cards[i].c[j].num==\"\"){\r\n              num++;\r\n            }\r\n          }\r\n        }\r\n        // console.log(num);\r\n        // 如果没有身份证框有cardRed样式，并且num=0,则执行提交订单操作\r\n        if(elems.length==0&&num==0){\r\n          // 将购物车信息保存在sessionStorage中\r\n        var cart=[];\r\n        for(var i=0; i<this.ticList.length; i++){\r\n          var info=[];\r\n          // console.log(info);\r\n          if(this.tics[i].t>0){\r\n            for(var j=0; j<this.tics[i].t; j++){\r\n              // 获得每个票种的单张票信息\r\n              var info1={};\r\n              // 票种\r\n              info1.book=this.ticList[i].tname;\r\n              // 身份证号\r\n              info1.bcard=this.cards[i].c[j].num;\r\n              // 价格\r\n              info1.bprice=this.ticList[i].tprice;\r\n              // 单张票的订单状态    0：未付款   1：已付款\r\n              info1.bstatus=0;\r\n              // 日期\r\n              info1.bdate=this.gdate;\r\n              // 当前登录的用户编号uid\r\n              info1.b_id=sessionStorage.getItem(\"uid\")\r\n              // console.log(info);\r\n              // 获得每个票种的所有票信息\r\n              info.push(info1);\r\n            }\r\n            // 放入购物车数组\r\n            cart.push(info);\r\n          }\r\n        }\r\n        console.log(cart);\r\n        // 将购物车数组转为JSON字符串str\r\n        var str=JSON.stringify(cart);\r\n        // 验证购物车是否为空\r\n        if(str==\"[]\"){\r\n          this.$toast(\"请选择门票\");\r\n        }else{\r\n          // 将str放入sessionStorage中\r\n          sessionStorage.setItem(\"cart\",str);\r\n          // console.log(sessionStorage.cart);\r\n          // 跳转到结算界面\r\n          this.$router.push(\"/BookCart\");\r\n        }\r\n        }\r\n        \r\n      },\r\n      // 输入框失去焦点事件\r\n      // 验证输入的身份证是否正确\r\n      cardOK(e){\r\n        // 获得当前输入框的值\r\n        var str=e.target.value;\r\n        // 正则表达式\r\n        var reg=/^\\d{15}(\\d\\d[0-9Xx])?$/;\r\n        if(!reg.exec(str)){\r\n          // 不符合，则更改cardMsg值，控制提示信息框的显示\r\n          // this.cardMsg=1;\r\n          e.target.className=\"cardRed\";\r\n        }else{\r\n          // 身份证改对后，把cardMsg值改回来\r\n          // this.cardMsg=0;\r\n          e.target.className=\"\";\r\n        }\r\n        // 如果身份证框有样式cardRed，则cardMsg为1，否则为0\r\n        // 保证只要有身份证不对，提示框显示\r\n        var cardDiv=document.getElementById(\"cards\");\r\n        var elems=cardDiv.getElementsByClassName(\"cardRed\");\r\n        console.log(elems);\r\n        if(elems.length>0){\r\n          this.cardMsg=1\r\n        }else{\r\n          this.cardMsg=0;\r\n        }\r\n\r\n      }\r\n      \r\n    },\r\n    created(){\r\n      // 功能1：页面运行到订单第二个页面\r\n      sessionStorage.setItem(\"pageNo2\",2);\r\n      // 功能2：判定用户是否已登录，如果没有，跳转到登录页面\r\n      if(!sessionStorage.getItem(\"uname\")){\r\n        // 将当前的路由地址保存在sessionStorage中，登录后可跳回此页面\r\n        sessionStorage.setItem(\"jumpRouter\",\"/BookTics\");\r\n        this.$messagebox(\"请先登录\")\r\n          .then(action=>{\r\n            this.$router.push(\"/Login\");\r\n          })\r\n          .catch(err=>{console.log(err)}\r\n        );\r\n      }\r\n      // 功能3：获得购票日期\r\n      this.gdate=sessionStorage.getItem(\"gdate\");\r\n      // 功能4：发送请求，获得票种列表\r\n      this.axios.get(\"tics\",{params:{}})\r\n      .then(res=>{\r\n        this.ticList=res.data;\r\n        // console.log(this.ticList);\r\n      });\r\n      // 功能5：判断程序是否运行过第三个订单页面，是，则向右箭头加路径\r\n      var num=sessionStorage.getItem(\"pageNo3\");\r\n      if(num==3){\r\n        this.jumpRight=\"/BookCart\";\r\n      };\r\n      // 功能6：页面跳转回此页面后恢复选择后的信息\r\n      var obj=JSON.parse(sessionStorage.cart);\r\n      for(var i=0;i<obj.length; i++){\r\n        console.log(obj[i][0]);\r\n        this.tics[i].t=obj[i].length;\r\n        // 获取购票数\r\n        console.log(this.tics[i].t,typeof(this.tics[i].t));\r\n        // 获取身份证号\r\n      }\r\n      \r\n    }\r\n  }\r\n</script>\r\n\r\n<style scoped>\r\n  .container{\r\n    background-color:#f2f2f2;\r\n    color:#333;\r\n    font-size:12px;\r\n  }\r\n  .content{\r\n    padding:40px 0px;\r\n  }\r\n  .top{\r\n    height:40px;\r\n    text-align:center;\r\n    line-height:40px;\r\n    background-color:#26a2ff;\r\n    color:#fff;\r\n    font-size:14px;\r\n  }\r\n  /* 身份证错误信息提示框 */\r\n  .cardMsg{\r\n    padding:10px;\r\n    text-align:center;\r\n    color:red;\r\n  }\r\n  /* 身份证错误标红 */\r\n  .cardRed{\r\n    color:red;\r\n  }\r\n  /* 票种列表样式 */\r\n  .tic{\r\n    padding:0px 20px;\r\n    padding-top:5px;\r\n    margin-bottom:5px;\r\n    color:#000;\r\n    font-size:16px;\r\n    background-color:#fff;\r\n  }\r\n  .tic1{\r\n    display:flex;\r\n    justify-content:space-between;\r\n  }\r\n  .tic1 span:last-child{\r\n    color:#e6a062;\r\n    padding-right:4px;\r\n  }\r\n  .tic2{\r\n    margin-top:10px;\r\n    padding-bottom:5px;\r\n    display:flex;\r\n    justify-content:space-between;\r\n    border-bottom:1px solid #f2f2f2;\r\n  }\r\n  .tic2 div:first-child{\r\n    font-size:13px;\r\n    color:#26a2ff;\r\n    border:1px solid #26a2ff;\r\n    width:60px;\r\n    height:20px;\r\n    text-align:center;\r\n    line-height:20px;\r\n    border-radius:3px;\r\n  }\r\n  .tic2 div.btns{\r\n    display:flex;\r\n  }\r\n  .tic2 div.btns span:nth-child(2){\r\n    display:inline-block;\r\n    width:30px;\r\n    color:#888;\r\n    text-align:center;\r\n    font-size:14px;\r\n  }\r\n  .tic2 div.btns span img{\r\n    width:20px;\r\n  }\r\n  .tic3{\r\n    padding:5px 0;\r\n    font-size:14px;\r\n    border-bottom:1px solid #f2f2f2;\r\n  }\r\n  .tic3 input{\r\n    border:none;\r\n    width:250px;\r\n    padding-left:5px;\r\n  }\r\n  /* 结算按钮和信息 */\r\n  .cartBtm{\r\n    position:fixed;\r\n    bottom:37px;\r\n    width:100%;\r\n    display:flex;\r\n    text-align:center;\r\n  }\r\n  .cartBtm p{\r\n    height:50px;\r\n    line-height:50px;\r\n    font-size:20px;\r\n    margin:0;\r\n  }\r\n  .cartBtm p:first-child{\r\n    width:50%;\r\n    color:#e6a062;\r\n    background:#fff;\r\n  }\r\n  .cartBtm p+p{\r\n    background-color:#e6a062;\r\n    width:50%;\r\n    color:#fff;\r\n  }\r\n</style>"],"sourceRoot":"src\\components\\booking\\common"}]}